<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>과정형 평가 1번</title>
    <script th:replace="~{fragment/scripts :: scriptFragment}"></script>
    <script th:replace="~{fragment/css :: cssFragment}"></script>
    <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/board.css}">
    <!-- Quill CDN -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
</head>
<body>
<div th:replace="~{fragment/header :: headerFragment}"></div>
<div th:replace="~{fragment/progress-bar :: progressBarFragment}"></div>
<div class="container">
    <div th:replace="~{fragment/menu :: menuFragment}"></div>
    <main>
        <h2>게시글 목록</h2>
        <div class="action-bar">
            <p><b>총 34건</b></p>
            <div class="action-buttons">
                <button id="openModal" class="register-button">등록</button>
                <button class="delete-button">삭제</button>
            </div>
        </div>
        <table class="table-container">
            <thead>
            <tr>
                <th class="checkbox-center"><input type="checkbox"></th>
                <th>순번</th>
                <th>작성자</th>
                <th>제목</th>
                <th>작성일</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>1</td>
                <td>이상주</td>
                <td>게시글 테스트1</td>
                <td>2024-09-04 11:02:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>2</td>
                <td>이준하</td>
                <td>게시글 테스트2</td>
                <td>2024-09-04 09:02:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>3</td>
                <td>장성일</td>
                <td>게시글 테스트3</td>
                <td>2024-09-03 11:02:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>4</td>
                <td>박종훈</td>
                <td>게시글 테스트4</td>
                <td>2024-09-03 10:02:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>5</td>
                <td>조현환</td>
                <td>게시글 테스트5</td>
                <td>2024-09-03 09:02:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>6</td>
                <td>김형재</td>
                <td>게시글 테스트6</td>
                <td>2024-09-02 11:42:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>7</td>
                <td>김승현</td>
                <td>게시글 테스트7</td>
                <td>2024-09-02 11:32:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>8</td>
                <td>노지원</td>
                <td>게시글 테스트8</td>
                <td>2024-09-02 11:02:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>9</td>
                <td>성준규</td>
                <td>게시글 테스트9</td>
                <td>2024-09-02 09:02:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>10</td>
                <td>홍성수</td>
                <td>게시글 테스트10</td>
                <td>2024-09-01 11:02:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>11</td>
                <td>이재범</td>
                <td>게시글 테스트11</td>
                <td>2024-09-01 10:02:14</td>
            </tr>
            <tr>
                <td class="checkbox-center"><input type="checkbox"></td>
                <td>12</td>
                <td>남상욱</td>
                <td>게시글 테스트12</td>
                <td>2024-09-01 09:02:14</td>
            </tr>
            </tbody>
        </table>
        <div class="pagination">
            <button class="page-button">1</button>
            <button class="page-button">2</button>
            <button class="page-button">3</button>
        </div>
    </main>
</div>

<!-- 게시글 작성,수정 모달 영역 -->
<div class="modal" id="myModal">
    <div class="modal-content">
        <span class="close-button" id="closeModal">&times;</span>
        <h2>게시글 작성</h2>
        <div class="form-group" style="flex-direction: row;">
            <label>작성자 </label>&nbsp;&nbsp;&nbsp;<span>이상주</span>
        </div>
        <div class="form-group">
            <label for="title">제목</label>
            <input type="text" id="title" name="title">
        </div>
        <div class="form-group">
            <label>내용</label>
            <div id="editor-container"></div>
        </div>
        <div class="button-group">
            <button class="primary">작성 완료</button>
            <button class="secondary" id="cancelButton">취소</button>
        </div>
    </div>
</div>

<!-- 게시글 상세조회 모달 -->
<div class="modal" id="postDetailModal">
    <div class="modal-content">
        <span class="close-button" id="closeDetailModal">&times;</span>
        <h2>게시글 상세조회</h2>
        <div class="form-group" style="flex-direction: row;">
            <label>작성자 </label>&nbsp;&nbsp;&nbsp;<span id="detail-author">이상주</span>
        </div>
        <div class="form-group" style="flex-direction: row;">
            <label>작성일</label>&nbsp;&nbsp;&nbsp;<span id="detail-date" style="margin-top: 2px;"></span>
        </div>
        <div class="form-group">
            <label for="detail-title">제목</label>
            <input type="text" id="detail-title" name="detail-title">
        </div>
        <div class="form-group">
            <label>내용</label>
            <div id="detail-container"></div>
        </div>
        <div class="form-group">
            <label>댓글 조회</label>
            <div id="detail-comments" class="comment-section">
                <!-- 댓글 내용이 동적으로 추가될 부분 -->
            </div>
        </div>
        <div class="form-group">
            <label style="height: 0px;">댓글 작성</label>
            <div class="button-group" style="justify-content: flex-start;">
                <input type="text" id="new-comment" name="new-comment" style="width: 86%;">
                <button class="secondary" id="addCommentButton" style="height: 10%;">작성</button>
            </div>
        </div>
        <div class="button-group">
            <button class="primary" id="detailEditButton">수정</button>
            <button class="delete-button" id="detailDeleteButton">삭제</button>
            <button class="secondary" id="detailCancelButton">취소</button>
        </div>
    </div>
</div>

<!-- 댓글 수정 모달 -->
<div class="modal" id="editCommentModal">
    <div class="modal-content">
        <span class="close-button" id="closeEditCommentModal">&times;</span>
        <h2>댓글 수정</h2>
        <div class="form-group">
            <label for="edit-comment">내용</label>
            <input type="text" id="edit-comment" name="edit-comment">
        </div>
        <div class="button-group">
            <button class="primary" id="confirmEditComment">확인</button>
            <button class="secondary" id="cancelEditComment">취소</button>
        </div>
    </div>
</div>

<div th:replace="~{fragment/footer :: footerFragment}"></div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {

        const quill = new Quill('#editor-container', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                    ['bold', 'italic', 'underline'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['link']
                ]
            }
        });

        const detailQuill = new Quill('#detail-container', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                    ['bold', 'italic', 'underline'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['link']
                ]
            }
        });


        // Quill 에디터 높이 조정
        document.querySelector('.ql-editor').style.height = '200px';
        document.querySelector('#detail-container .ql-editor').style.height = '150px';

        const openModalButton = document.getElementById('openModal');
        const modal = document.getElementById('myModal');
        const closeModalButton = document.getElementById('closeModal');
        const cancelButton = document.getElementById('cancelButton');
        const modalContent = document.querySelector('.modal-content');

        // 모달 열기
        openModalButton.addEventListener('click', function() {
            modal.style.display = 'flex';
        });

        // 모달 닫기
        function closeModal() {
            modal.style.display = 'none';
        }

        // 닫기 버튼 클릭 시 모달 닫기
        closeModalButton.addEventListener('click', closeModal);

        // 취소 버튼 클릭 시 모달 닫기
        cancelButton.addEventListener('click', closeModal);

        // 모달 영역 밖 클릭 시 모달 닫기 방지
        modal.addEventListener('click', function(event) {
            if (event.target === modal) {
                // 영역 밖 클릭 시에는 아무 동작도 하지 않음
            }
        });

        // 모달 내용 클릭 시 클릭 이벤트가 모달 영역으로 전파되지 않도록
        modalContent.addEventListener('click', function(event) {
            event.stopPropagation();
        });

        /* 상세 조회 모달 */
        const postDetailModal = document.getElementById('postDetailModal');
        const closeDetailModalButton = document.getElementById('closeDetailModal');
        const detailCancelButton = document.getElementById('detailCancelButton');
        detailCancelButton.addEventListener('click', closeDetailModal);

        // Close modal function
        function closeDetailModal() {
            postDetailModal.style.display = 'none';
        }

        // Attach close modal event
        closeDetailModalButton.addEventListener('click', closeDetailModal);

        // Function to open the post detail modal
        function openPostDetailModal(postData) {
            postDetailModal.style.display = 'flex';

            document.getElementById('detail-title').value = postData.title;
            document.getElementById('detail-author').innerText = postData.author;
            document.getElementById('detail-date').innerText = postData.date;
            detailQuill.root.innerHTML = postData.content;

            // Clear existing comments
            const commentSection = document.getElementById('detail-comments');
            commentSection.innerHTML = '';

            // Populate comments
            postData.comments.forEach(comment => {
                const commentElement = document.createElement('p');
                commentElement.textContent = `${comment.author} / ${comment.content} / ${comment.date}`;
                const deleteCommentButton = document.createElement('span');
                const updateCommentButton = document.createElement('span');

                deleteCommentButton.className = 'delete-comment';
                deleteCommentButton.textContent = '삭제';
                deleteCommentButton.addEventListener('click', function() {
                    // Handle comment deletion here
                    alert('삭제 버튼 클릭');
                });

                commentElement.appendChild(deleteCommentButton);

                updateCommentButton.className = 'update-comment';
                updateCommentButton.textContent = '수정';
                updateCommentButton.addEventListener('click', function() {
                    // Handle comment deletion here
                    openEditCommentModal(commentElement);
                });

                commentElement.appendChild(updateCommentButton);
                commentSection.appendChild(commentElement);
            });

        }

        // 댓글 수정 모달 관련 변수
        const editCommentModal = document.getElementById('editCommentModal');
        const closeEditCommentModalButton = document.getElementById('closeEditCommentModal');
        const cancelEditCommentButton = document.getElementById('cancelEditComment');
        const confirmEditCommentButton = document.getElementById('confirmEditComment');
        const editCommentInput = document.getElementById('edit-comment');
        let currentCommentElement = null;  // 현재 수정할 댓글 요소 저장

        // 댓글 수정 모달 열기
        function openEditCommentModal(commentElement) {
            currentCommentElement = commentElement;  // 현재 수정할 댓글 저장
            editCommentInput.value = commentElement.textContent.split('/')[1].trim();  // 댓글 내용을 입력창에 넣음
            editCommentModal.style.display = 'flex';
        }

        // 댓글 수정 모달 닫기
        function closeEditCommentModal() {
            editCommentModal.style.display = 'none';
        }

        // 모달 닫기 이벤트
        closeEditCommentModalButton.addEventListener('click', closeEditCommentModal);
        cancelEditCommentButton.addEventListener('click', closeEditCommentModal);

        // 댓글 수정 확인 버튼 이벤트
        confirmEditCommentButton.addEventListener('click', function() {
            if (currentCommentElement) {
                const newContent = editCommentInput.value;
                currentCommentElement.childNodes[0].nodeValue = `${currentCommentElement.textContent.split('/')[0]} / ${newContent} / ${currentCommentElement.textContent.split('/')[2].trim().substr(0,19)}`;
                closeEditCommentModal();
            }
        });

        // 댓글 수정 버튼 클릭 시 모달 열기
        function attachUpdateCommentEvent(commentElement) {
            commentElement.querySelector('.update-comment').addEventListener('click', function () {
                openEditCommentModal(commentElement);
            });
        }

        // 각 댓글에 수정 이벤트 연결 (예시)
        const comments = document.querySelectorAll('#detail-comments p');
        comments.forEach(function (commentElement) {
            attachUpdateCommentEvent(commentElement);
        });

        const tableRows = document.querySelectorAll('table tbody tr');


        // Loop through each row and attach a click event listener
        tableRows.forEach(function(row) {
            row.addEventListener('click', function boardDetail() {
                // For testing: Open the modal with some sample data
                openPostDetailModal({
                    title: row.children[3].innerText,
                    author: row.children[2].innerText,
                    date: row.children[4].innerText,
                    content: row.children[2].innerText + ' ' + row.children[3].innerText,
                    comments: [
                        {author: '이준하', content: '댓글 내용1', date: '2023-09-01 12:34:56'},
                        {author: '박종훈', content: '댓글 내용2', date: '2023-08-30 12:34:56'}
                    ]
                });
            });
        });


    });


</script>
</html>
