<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>과정형 평가 1번</title>
    <script th:replace="~{fragment/scripts :: scriptFragment}"></script>
    <script th:replace="~{fragment/css :: cssFragment}"></script>
    <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/user.css}">
</head>
<body>
<div th:replace="~{fragment/header :: headerFragment}"></div>
<div th:replace="~{fragment/progress-bar :: progressBarFragment}"></div>
<div class="container">
    <div th:replace="~{fragment/menu :: menuFragment}"></div>
    <main>
        <h2>사용자 목록</h2>
        <div class="action-bar">
            <p><b>총 40건</b></p>
            <div class="action-buttons">
                <button class="register-button">등록</button>
                <button class="delete-button">삭제</button>
            </div>
        </div>
        <table class="table-container">
            <thead>
            <tr>
                <th class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></th>
                <th>순번</th>
                <th>아이디</th>
                <th>이름</th>
                <th>전화번호</th>
                <th>주소</th>
                <th>가입일자</th>
                <th>사용자 등급</th>
                <th>잠김 여부</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>1</td>
                <td>admin1</td>
                <td>이상주</td>
                <td>010-1234-5678</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>관리자</td>
                <td></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>2</td>
                <td>admin2</td>
                <td>이준하</td>
                <td>010-1234-5677</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>관리자</td>
                <td><lock>✔</lock></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>3</td>
                <td>admin3</td>
                <td>장성일</td>
                <td>010-1234-5676</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>중간 관리자</td>
                <td></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>4</td>
                <td>admin4</td>
                <td>박종훈</td>
                <td>010-1234-5675</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>중간 관리자</td>
                <td><lock>✔</lock></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>5</td>
                <td>admin5</td>
                <td>조현환</td>
                <td>010-1234-5675</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>일반 사용자</td>
                <td><lock>✔</lock></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>6</td>
                <td>admin6</td>
                <td>김형재</td>
                <td>010-1234-5675</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>일반 사용자</td>
                <td><lock>✔</lock></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>7</td>
                <td>admin7</td>
                <td>김승현</td>
                <td>010-1234-5675</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>일반 사용자</td>
                <td><lock>✔</lock></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>8</td>
                <td>admin8</td>
                <td>노지원</td>
                <td>010-1234-5675</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>일반 사용자</td>
                <td><lock>✔</lock></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>9</td>
                <td>admin9</td>
                <td>성준규</td>
                <td>010-1234-5675</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>일반 사용자</td>
                <td><lock>✔</lock></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>10</td>
                <td>admin10</td>
                <td>홍성수</td>
                <td>010-1234-5675</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>일반 사용자</td>
                <td><lock>✔</lock></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>11</td>
                <td>admin11</td>
                <td>이재범</td>
                <td>010-1234-5675</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>일반 사용자</td>
                <td><lock>✔</lock></td>
            </tr>
            <tr>
                <td class="checkbox-center" onclick="event.cancelBubble=true"><input type="checkbox"></td>
                <td>12</td>
                <td>admin12</td>
                <td>남상욱</td>
                <td>010-1234-5675</td>
                <td>서울 영등포구 영등포로 33 목동비즈타워 608호</td>
                <td>2023-01-01 14:45:30</td>
                <td>일반 사용자</td>
                <td><lock>✔</lock></td>
            </tr>
            </tbody>
        </table>
        <div class="pagination">
            <button class="page-button">1</button>
            <button class="page-button">2</button>
            <button class="page-button">3</button>
        </div>
    </main>
</div>

<!-- Modal Structure -->
<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2 id="modal-title">사용자 등록</h2>
        <div class="form-group">
            <div class="modal-user-info">
                <img th:src="@{/image/profile.png}" class="modal-profile-pic" alt="Profile Picture" id="modal-profile-pic"/>
                <div class="dropdown-menu" id="modal-dropdown-menu">
                    <ul>
                        <li><a href="#" id="profile-button">프로필 업로드</a></li>
                        <li><a href="#">제거</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label>번호</label>
            <span>12345</span>
        </div>

        <div class="form-group" id="id-form">
            <label for="user-id">아이디</label>
            <input type="text" id="user-id">
        </div>

        <div class="form-group">
            <label for="username">이름</label>
            <input type="text" id="username">
        </div>

        <div class="form-group">
            <label for="phone">전화번호</label>
            <input type="text" id="phone">
        </div>

        <div class="form-group">
            <label for="address">주소</label>
            <div class="address-group">
                <div class="address-top">
                    <input type="text" id="address" placeholder="우편번호">
                    <button class="search-button">검색</button>
                </div>
                <input type="text" id="additional-info">
            </div>
        </div>

        <div class="form-group">
            <label for="role">사용자 등급</label>
            <select id="role">
                <option value="A">관리자</option>
                <option value="B">중간 관리자</option>
                <option value="C">일반 사용자</option>
            </select>
        </div>

        <div class="button-group">
            <button class="primary" id="modalButton">저장</button>
            <button class="delete-button" id="modalDeleteButton">삭제</button>
            <button class="secondary close-button" id="modalCancelButton">취소</button>
        </div>
    </div>
</div>

<script>

    document.addEventListener('DOMContentLoaded', function() {
        // 모달 요소 가져오기
        let modal = document.getElementById("modal");

        // 모달 열기 버튼 가져오기
        let registerButton = document.querySelector(".register-button");

        // 닫기 버튼 가져오기
        let closeButton = document.querySelectorAll(".close-button");

        // 모달 열기
        registerButton.addEventListener("click", openDetailModal);

        // 모달 닫기
        closeButton.forEach(function (btn) {
            btn.addEventListener("click", function() {
                modal.style.display = "none";
            });
        });

        // 모달 외부 클릭 시 닫히지 않도록 설정
        window.addEventListener("click", function(event) {
            if (event.target === modal) {
                event.stopPropagation();
            }
        });

        // Function to open the post detail modal
        function openDetailModal(postData) {

            modal.style.display = "block";

            if (postData.username) {
                document.getElementById("id-form").style.display = "none";
                document.getElementById("modal-title").innerText = postData.userId;
                document.getElementById("modalButton").innerText = '수정';
                document.getElementById("modalDeleteButton").style.display = "";
                document.getElementById("modalCancelButton").style.display = "none";

                document.getElementById('username').value = postData.username;
                document.getElementById('phone').value = postData.phone;
                document.getElementById('address').value = postData.additionalInfo;
                document.getElementById('additional-info').value = postData.address;
                document.getElementById('role').value = postData.role;
                return;
            }

            document.getElementById("modal-title").innerText = "사용자 등록";
            document.getElementById("id-form").style.display = "";
            document.getElementById("modalButton").innerText = '저장';
            document.getElementById("modalDeleteButton").style.display = "none";
            document.getElementById("modalCancelButton").style.display = "";

            document.getElementById('username').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('address').value = '';
            document.getElementById('additional-info').value = '';
            document.getElementById('role').value = 'A';


        }

        const tableRows = document.querySelectorAll('table tbody tr');


        // Loop through each row and attach a click event listener
        tableRows.forEach(function(row) {
            row.addEventListener('click', function boardDetail() {
                // For testing: Open the modal with some sample data
                openDetailModal({
                    userId: row.children[2].innerText,
                    username: row.children[3].innerText,
                    phone: row.children[4].innerText,
                    address: row.children[5].innerText,
                    additionalInfo: '23232',
                    role: row.children[7].innerText == '관리자'?'A':row.children[7].innerText == '중간 관리자'?'B':'C',
                });
            });
        });

        const modalProfilePic = document.getElementById('modal-profile-pic');
        const modalDropdownMenu = document.getElementById('modal-dropdown-menu');
        const profileButton = document.getElementById('profile-button');
        const fileInput = document.getElementById('file-input');

        // 프로필 이미지 클릭 시 드롭다운 메뉴 토글
        modalProfilePic.addEventListener('click', function() {
            modalDropdownMenu.style.display = modalDropdownMenu.style.display === 'none' || modalDropdownMenu.style.display === ''
                ? 'block'
                : 'none';
        });

// 메뉴 이외의 영역 클릭 시 드롭다운 닫기
        document.addEventListener('click', function(event) {
            if (!modalProfilePic.contains(event.target) && !modalDropdownMenu.contains(event.target)) {
                modalDropdownMenu.style.display = 'none';
            }
        });

        profileButton.addEventListener('click', function() {
            fileInput.click();  // 파일 선택 창 열기
        });

        // 파일 선택 시 새로운 프로필 이미지 미리보기 설정
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('modal-profile-pic').src = e.target.result;  // 모달의 이미지 변경
                };
                reader.readAsDataURL(file);  // 선택한 파일 읽기
            }
        });


    });

</script>
</body>
</html>